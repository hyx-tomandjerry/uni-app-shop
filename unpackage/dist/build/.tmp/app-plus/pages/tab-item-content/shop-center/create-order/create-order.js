(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/tab-item-content/shop-center/create-order/create-order"],{"0178":function(e,t,s){"use strict";var n=s("edff"),a=s.n(n);a.a},"036f":function(e,t,s){"use strict";s.r(t);var n=s("f8cc"),a=s.n(n);for(var i in n)"default"!==i&&function(e){s.d(t,e,function(){return n[e]})}(i);t["default"]=a.a},"1a4e":function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},a=[];s.d(t,"a",function(){return n}),s.d(t,"b",function(){return a})},"4cba":function(e,t,s){"use strict";s.r(t);var n=s("1a4e"),a=s("036f");for(var i in a)"default"!==i&&function(e){s.d(t,e,function(){return a[e]})}(i);s("0178");var o=s("2877"),r=Object(o["a"])(a["default"],n["a"],n["b"],!1,null,null,null);t["default"]=r.exports},edff:function(e,t,s){},f8cc:function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(s("df5e"));function a(e){return e&&e.__esModule?e:{default:e}}var i=s("c4e7"),o=function(){return s.e("components/uni/uni-icon/uni-icon").then(s.bind(null,"f177"))},r=function(){return s.e("components/uni/mx-datepicker/mx-datepicker").then(s.bind(null,"51fd"))},u={props:[],data:function(){return{showPicker:!1,value:"",index:-1,imgList:[],itemComponents:[],num:1,amapPlugin:null,key:"4c523fb1857f99ba7f2d683d9e88ec1e",shop:{name:"",address:"",id:""},designer:{name:"",telephone:"",date:""},repair:{subID:"",subName:"",bigName:"",summary:""},files:[],type:"rangetime"}},components:{uniIcon:o,MxDatePicker:r},getOpenDate:function(){var e=new Date;return this.format(e,"YMD")},onLoad:function(t){var s=this;(t.sbuID||t.subName||t.bigName)&&(this.repair.subID=t.subID,this.repair.subName=t.subName,this.repair.bigName=t.bigName,e.getStorage({key:"name",success:function(e){s.designer.name=e.data}}),e.getStorage({key:"telephone",success:function(e){s.designer.telephone=e.data}}),e.getStorage({key:"time",success:function(e){s.designer.date=e.data}})),this.amapPlugin=new n.default.AMapWX({key:this.key}),this.getRegeoInfo(),this.getUploadToken(),this.$store.state.userInfo&&(this.designer.name=this.$store.state.userInfo.name,this.designer.telephone=this.$store.state.userInfo.mobile,e.setStorage({key:"name",data:this.$store.state.userInfo.name}),e.setStorage({key:"telephone",data:this.$store.state.userInfo.mobile}))},methods:{goBack:function(){e.navigateTo({url:"../shop-list/shop-list"})},inputTel:function(t){e.setStorage({key:"telephone",data:t.detail.value})},inputName:function(t){e.setStorage({key:"name",data:t.detail.value})},onSelected:function(t){this.showPicker=!1,t&&(this[this.type]=t.value,this.designer.date=t.value,e.setStorage({key:"time",data:t.value}))},onShowDatePicker:function(e){this.type=e,this.showPicker=!0,this.value=this[e]},getRegeoInfo:function(){var t=this;e.showLoading({title:"获取位置中..."}),this.amapPlugin.getRegeo({success:function(s){t.$store.commit("setProvince",s[0].regeocodeData.addressComponent.province),t.$store.commit("setAddress",s[0].regeocodeData.formatted_address),e.request({url:t.$store.state.url+"NearestShops",data:{owner:t.$store.state.userInfo.owner,userId:t.$store.state.userInfo.id,address:"".concat(s[0].regeocodeData.addressComponent.province).concat(s[0].regeocodeData.formatted_address),size:8},success:function(e){t.shop.name=e.data.data[0].name,t.shop.address=e.data.data[0]["provinceName"]+e.data.data[0]["cityName"]+e.data.data[0]["districtName"],t.shop.id=e.data.data[0].id}}),e.hideLoading()},fail:function(t){e.hideLoading()}})},showNearShopList:function(){e.navigateTo({url:"../near-shop-list/near-shop-list?shopAddress="+this.shop.address})},showRepairItem:function(){e.navigateTo({url:"../repair-item/repair-item"})},addRepairItem:function(){this.num++,this.itemComponents.push({})},ChooseImageEvent:function(){var t=this;e.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album"],success:function(s){0!=t.imgList.length?t.imgList=t.imgList.concat(s.tempFilePaths):t.imgList=s.tempFilePaths;for(var n={params:{"x:owner":t.$store.state.userInfo.owner,"x:creator":t.$store.state.userInfo.id,"x:type":t.$store.state.constants.serviceorder_file}},a={useCdnDomain:!1},o=0;o<s.tempFilePaths.length;o++){var r=i.upload(s.tempFilePaths[o],"oaks"+s.tempFilePaths[o].split("/")+1e6*Math.random()+".jpg",t.token,n,a);r.subscribe(function(){},function(){},function(s){t.files.push(s.data),t.files.length===t.imgList.length&&e.showToast({title:"上传成功",icon:"success"})})}}})},ViewImage:function(t){e.previewImage({urls:this.imgList,current:t})},DelImg:function(t){var s=this;e.showModal({content:"确定删除？",cancelText:"取消",confirmText:"确定",success:function(n){n.confirm&&(s.imgList.splice(t,1),e.request({url:s.$store.state.url+"RemoveFiles",data:{id:s.files[t],owner:s.$store.state.userInfo.owner,userId:s.$store.state.userInfo.id},success:function(n){s.files.splice(t,1),e.showToast({title:"删除成功",icon:"none"})}}))}})},textareaAInput:function(e){this.textareaAValue=e.detail.value},delComponent:function(e){console.log(e," at pages\\tab-item-content\\shop-center\\create-order\\create-order.vue:452"),this.itemComponents.splice(e,1),this.num>1&&this.num--},delRepairItem:function(e){this.itemComponents.splice(e,1)},createOrder:function(){var t="";this.files.length>0&&(t=this.files.join(",")),this.repair.subID?this.repair.summary?e.request({url:this.$store.state.url+"NewServiceOrder",data:{owner:this.$store.state.userInfo.owner,catalog:this.repair.subID,creator:this.$store.state.userInfo.id,shop:this.shop.id,appointdate:this.designer.date?this.designer.date:this.getOpenDate,summary:this.repair.summary,files:t,contractor:this.designer.name?this.designer.name:this.$store.state.userInfo.name,telephone:this.designer.telephone?this.designer.telephone:this.$store.state.userInfo.mobile},success:function(t){e.showToast({title:"新增报修成功",icon:"success"}),setTimeout(function(){e.navigateTo({url:"../shop-center"}),e.clearStorage()},500)}}):e.showToast({title:"请输入报修描述",icon:"none"}):e.showToast({title:"请选择报修类别",icon:"none"})},getUploadToken:function(){var t=this;e.request({url:this.$store.state.url+"UploadToken",success:function(e){t.token=e.data.data}})}}};t.default=u}).call(this,s("6e42")["default"])}},[["56aa","common/runtime","common/vendor"]]]);